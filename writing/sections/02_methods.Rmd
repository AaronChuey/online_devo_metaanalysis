```{r prisma, fig.cap = "PRISMA plot detailing our study screening process."}
library(tidyverse)
library(here)
#library(googlesheets4)
library(readxl)

source(here("scripts/prisma_diagram.R"))

# Read in Data 
#d <- read_sheet("https://docs.google.com/spreadsheets/d/1ctTyXRj0Sd037P0zTd-eulFQjrWEbuOx-c-n5VAcwr0/edit#gid=0")
d <- readxl::read_xlsx(here("Online Testing Paper Decision Spreadsheet.xlsx"))


# identify total records screend
d_found <- d %>% 
  mutate(
    source_cat = case_when(
      Source %in% c("Frontiers", "Lookit1", 
                    "Lookit2", "Rhodes", "Sheskin&Keil") ~ "database_search", 
      TRUE ~ "expert_opinion"
    )) %>% 
  group_by(source_cat) %>% 
  count()
 
# identify total duplicates records 
d_duplicate <- d %>% 
  mutate(duplicate = case_when(
    Title_screening_decision == "duplicate" ~ "yes", 
    TRUE ~ "no"
  )) %>% 
  group_by(duplicate) %>% 
  count()

# identify records screened 
d_record_screened <- d %>% 
  filter(Title_screening_decision != "duplicate") %>% 
  group_by(Title_screening_decision) %>% 
  count()

# final decision 
d_full_text <- d %>% 
  filter(Title_screening_decision == "yes") %>% 
  filter(!is.na(Eligibility_decision)) %>% 
  group_by(Eligibility_decision) %>% 
  count()


prisma2(found = filter(d_found, source_cat == "database_search")$n, 
       found_other = filter(d_found, source_cat == "expert_opinion")$n, 
       no_dupes = filter(d_duplicate, duplicate == "no")$n, 
       screened = filter(d_duplicate, duplicate == "no")$n, 
       screen_exclusions =  filter(d_duplicate, duplicate == "no")$n - sum(d_full_text$n), 
       full_text = sum(d_full_text$n), 
       full_text_exclusion = filter(d_full_text, Eligibility_decision == "no")$n, 
       quantitative = filter(d_full_text, Eligibility_decision == "yes")$n,
       font_size = 10, 
       dpi = 72)

  
```

We conducted a literature search following the Preferred Reporting Items for Systematic Reviews and Meta-Analyses (PRISMA) procedure [@moher2015preferred]; see Figure \@ref(fig:prisma). For each set of studies determined to be an online replication, we calculated the effect size(s) and associated variance for the main effect of interest. We then conducted a series of random-effects multilevel meta-regressions to estimate the effect of online data collection, as well as three possible moderators (online study method, type of dependent measure, and participant age). Our preregistered data selection, coding, and analysis plan can be found at (FIXME insert url). The list of papers included in this meta-analysis is shown in Table \@ref(tab:list).

## Literature Search 

Our goal was to find as many published and unpublished online replications of developmental studies as possible. However, because there is no common nomenclature for online replications and the studies themselves cover a wide range of research questions and methodologies, searching via specific terms or keywords was difficult and produced many irrelevant papers. Instead, we preregistered a forward citation search strategy based on key papers on online developmental research. We used the papers that conducted initial validation of popular online testing platforms as our seeds, including Lookit [@scott2017lookit; @scott2017lookitB], The Child Lab [@sheskin2018thechildlab], and Pandas [@rhodes2020advancing]. We also included all papers published in the Frontiers in Psychology Special Issue: Empirical Research at a Distance: New Methods for Developmental Science, which largely focused on online developmental studies and replications. Finally, we posted a call for contributions to the Cognitive Development Society and ICIS listservs, two popular emailing lists frequented by developmental researchers. This call yielded several publications our initial search strategy missed, as well as six unpublished but complete online replications.

We preregistered several eligibility criteria to filter articles from our search: 

1. The study must be experimental, where participants complete a task with a stimulus. This criterion precludes surveys or purely observational measures. 

2. The studies must report two groups of children, one tested online and another tested in-person. Although the online sample must be collected by the researchers reporting the results, the in-person sample could either be collected at the same time or referenced from an existing publication. 

3. The mean age of the sample should be under six years. This criterion limits the studies to those conducted on relatively younger children for whom online data collection methods have not been traditionally employed. 

4. All data reported or referred to must contain codeable effect sizes. Verbal comparison alone between an online or in-person study or a qualitative description of results is not enough to determine the precise effect size of interest. 

5. Data collection for both the in-person and online sample must be complete; any incomplete or partial samples were not considered.

6. The online and in-person methods must be directly comparable. Some alteration to the study methods is expected when adapting an in-person study to be run online (e.g., changing a preferential reaching measure into a preferential looking measure, having children refer to objects by color instead of pointing, etc). However, we excluded any studies whose methodologies altered the nature of the task or the conclusions that could be drawn from them (e.g., manipulating the identity of an object instead of its location). 

```{r}
library(tidyverse)
library(googledrive)
library(readxl)
library(metafor)
library(assertthat)
library(glue)
library(wesanderson)
library(gridExtra)
library(here)
source(here("scripts/compute_es.R"))
library(kableExtra)
knitr::opts_chunk$set(
                      echo=F, warning=F, 
                      message=F, sanitize = T)

d <- readxl::read_xlsx(here("Effect size coding (online testing MA).xlsx"))

ages <- d |> select(short_cite,expt_condition, mean_age_1, mean_age_2, n_1, n_2, response_mode, method) |> 
  mutate(avg_age=ifelse(is.na(n_2), mean_age_1, (mean_age_1*n_1+mean_age_2*n_2)/(n_1+n_2)),
         n=ifelse(is.na(n_2),n_1, n_1+n_2)) |> 
  group_by(short_cite) |> 
  summarize(avg_age=weighted.mean(avg_age,n),
            n_studies=n())

mod <- d |> select(short_cite, response_mode) |> unique() |> 
  group_by(short_cite) |> 
  mutate(val=1) |> 
  pivot_wider(names_from=c(response_mode), values_from=val, values_fill = 0) |> 
  mutate(method=case_when(
    `non-looking`==1&looking==1 ~ "Both",
    `non-looking`==1 ~ "Verb",
    looking==1 ~ "Look"
  )) |> select(short_cite, method)

condition <- d |> filter(expt_condition=="online") |>  select(short_cite, method) |> unique() |> 
  group_by(short_cite) |> 
  mutate(val=1) |> 
  pivot_wider(names_from=c(method), values_from=val, values_fill = 0) |> 
  mutate(moderation=case_when(
    `unmoderated`==1&moderated==1 ~ "Both",
    `unmoderated`==1 ~ "Unmod",
    moderated==1 ~ "Mod"
  )) |> select(short_cite, moderation)

online <- d|> ungroup() |> filter(expt_condition=="online") |>
  mutate(n_2=replace_na(n_2,0), 
         mean_age_2=replace_na(mean_age_2,0),
         online_age=(n_1*mean_age_1+n_2*mean_age_2)/(n_1+n_2),
         online_count=n_1+n_2) |> 
  select(d, d_var, effect_size_group, response_mode, method, short_cite, online_age,online_count) |> 
  rename(d_online=d,d_var_online=d_var)

in_person <-  d |> ungroup()|> filter(expt_condition=="in-person") |> 
   mutate(n_2=replace_na(n_2,0), 
         mean_age_2=replace_na(mean_age_2,0),
         inperson_age=(n_1*mean_age_1+n_2*mean_age_2)/(n_1+n_2),
         inperson_count=n_1+n_2) |> 
  select(d, d_var, effect_size_group, inperson_age, inperson_count) |> 
  rename(d_inperson=d,d_var_inperson=d_var)

pairs <- full_join(online, in_person) |> 
  mutate(d_diff=d_online-d_inperson,
         d_diff_var=d_var_online+d_var_inperson,
         age=(inperson_age*inperson_count+online_age*online_count)/
           (online_count+inperson_count)) |> 
  group_by(short_cite) |> summarize(pairs=n())

studies <- ages |> left_join(pairs) |> left_join(mod) |> left_join(condition) |> select(-n_studies) |> mutate(avg_age=round(avg_age)) |> ungroup()
```

```{r list}
d |> filter(expt_condition=="in-person") |> select(main_title, `comparison-title`, short_cite, comparison_cite) |> unique() |> left_join(studies) |> 
  mutate(comparison_cite=ifelse(short_cite=="scott2017lookitB","teglas2007intuitions and @pasquini2007preschoolers", comparison_cite)) |> #this is bad practice, but we really do need to fix just this one row!
  mutate(short_cite=str_c("@", short_cite), comparison_cite=ifelse(is.na(comparison_cite),"",str_c("compared to @",comparison_cite))) |> 
  mutate(`Paper`=str_c(short_cite," ",comparison_cite)) |> 
  
  select(`Paper`, `Pairs`=pairs, `Look`=method, `Mod`=moderation, `Age`=avg_age) |> 
   unique() |> 
  arrange(Age) |> 
  knitr::kable(caption = "Papers used in this meta-analysis. Some papers contained both online and in-person results, others contained online replications compared to previous in-person papers. Pairs is number of online -- in-person pairs contributed by each paper (set). Look is whether the studies are use looking, verbal, or both types of dependent measures. Mod is whether the online studies were moderated, unmoderated, or both. Age is the average age of the participants in months. ", booktabs=T, format="markdown", linesep="")
```
## Data Entry 

All papers (320) yielded by our search procedure went through three rounds of evaluation to determine if they met our inclusion criteria. First, we screened the titles of the papers to determine whether they might include an online experiment. Those that clearly did not meet one or more of our inclusion criteria were excluded from further evaluation. Next, we performed a similar evaluation based on the papersâ€™ abstracts, before a final round based on the article as a whole. All remaining papers were entered into a spreadsheet that coded the necessary information for us to calculate the size of the main effect(s) of interest and their associated variance (sample size, group means and standard deviation, and t and F statistics when applicable), as well as our preregistered moderators (study modality, data collection method, dependent measure, and participant age). 

If a paper reported an effect size as cohen's d (referred to below as standardized mean difference, SMD), we coded it directly. Otherwise, we calculated the individual effect sizes for each main effect and each study (online and in-person) using reported means and standard deviations, t statistic, or directly from the data if it was available. If the main comparison was to chance performance, we first calculated log odds and then converted the effect size to cohen's d via the compute.es package in R (Del Re & Del Re, 2012). If a given study had multiple dependent measures or central hypotheses, we calculated an effect size and associated variance for each.

## Analytic Approach 

To determine whether study modality (online or in-person) moderated the size of the main effect of interest for each set of studies, we performed a random-effects multilevel meta-regression using the metafor package [@viechtbauer2010conducting]. The regression predicts effect size (SMD) with study modality as a fixed effect. 

Our analysis reflects a key design choice for our meta-analysis. Naively, it might appear to be possible to predict the size of the online-offline difference for a particular study. But on examination, many papers are heterogeneous and contain multiple online studies for a given offline study, or multiple measures for the same study. In these cases, the appropriate difference was not always clear. Further, many pairs of studies differed on some value of our chosen moderators. 

To deal with these issues, we instead modeled individual experimental effect sizes, with the coefficient of interest being the study modality predictor (online vs. in-person). We included two random intercepts in our models. The first random intercept controlled for variation between  particular experiments (e.g., modeling the dependency between multiple measurements reported from a single experiment). The second controlled for variation between groups of participants (e.g., modeling the dependency between effect sizes from participants who completed a battery of tasks with multiple effects of interest). 

To determine the effect of additional moderators (online study method, dependent measure, and participant age), we conducted three additional multilevel meta-regressions each with an additional fixed effect plus the corresponding interaction with study modality. All analysis scripts were preregistered and available at [FIXME link].




